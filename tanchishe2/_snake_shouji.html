<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>snake</title>
	<style>
		#fenshu{
			display: inline-block;
			position: absolute;
			left: : : 0px;
			top: 0px;
			font-weight: bold;
			color: #38CBF4;
			text-shadow: 1px 1px 1px navy;
			z-index: 10;
		}
		#f{
			display: inline-block;
			color: #C90000;
			text-shadow: 1px 1px 1px pink;
		}
		#kaishi{
			position: fixed;
			z-index: 2;
			left: 50%;
			top:50%;
			margin-left: -50px;
			margin-top:-30px;
			background-color: rgba(30,164,9,.5);
			border:solid 1px #38CBF4;
			color: pink;
			text-shadow: 1px 1px 1px navy;
			width: 100px;
			height: 60px;
			line-height: 60px;
			text-align: center;
			border-radius: 4px;
			font-size: 24px;
		}
	</style>
</head>
<body>
<div id="fenshu">
游戏积分：<div id="f"></div>
</div>
<div id="kaishi">开始</div>
<script type="text/javascript">
//全局对象
var map=null;//面板
var food=null;//食物
var snake=null;//蛇
var time=null;//定时器
var score=0;//游戏分数
var range=20;//步长
var width=window.innerWidth;//画布宽度
var height=window.innerHeight;//画布高度
var stepW=width/range;
var stepH=height/range;
window.onload=function(){
	/*绘制面板*/
	map=new Maps();
	map.show();
	/*食物*/
	food=new Food();
	food.foodShow();
	/*画蛇*/
	snake=new Snake();
	snake.showSection();

	/*移动端的触摸事件*/
	 document.addEventListener('touchstart',function(e){
		var e=e||window.event;
		console.dir(e);
		var x=e.changedTouches[0].clientX;
		var y=e.changedTouches[0].clientY;
		if(snake.sectionHeadRun=='left'||snake.sectionHeadRun=='right'){
			if(y>snake.section[snake.section.length-1][1]*range){
				snake.sectionHeadRun='down';
			}else{
				snake.sectionHeadRun='up';
			}
		}else{
			if (x>snake.section[snake.section.length-1][0]*range) {
				snake.sectionHeadRun='right';
			}else{
				snake.sectionHeadRun='left';
			}
		}
	})






	/*给body添加键盘事件*/
	document.body.onkeydown=function(event){
		if (event.keyCode==38) {
			snake.sectionHeadRun='up';
		}
		if(event.keyCode==40){
			snake.sectionHeadRun='down';
		}
		if(event.keyCode==37){
			snake.sectionHeadRun='left';
		}
		if(event.keyCode==39){
			snake.sectionHeadRun='right';
		}
	}



}
/*画地图*/
function Maps(){
	this.width=window.innerWidth;
	this.height=window.innerHeight;
	this.color='#776F56';
	this.show=function(){
		var div = document.createElement("div");
		div.style.width=this.width+"px";
		div.style.height=this.height+"px";
		div.style.background=this.color;
		div.style.position="absolute";
		div.style.left=0;
		div.style.top=0;
		document.body.appendChild(div); 
	}

}




/*画食物*/
function Food(){
	this.width=20;
	this.height=20;
	this.color='#3AB2FF';
	this.potato=null;//具体食物防止重复生成
	this.foodShow=function(){
		 if(this.potato==undefined){
		 	this.potato=document.createElement("div");
		 	this.potato.style.width=this.width-2+"px";
			this.potato.style.height=this.height-2+"px";
			this.potato.style.background=this.color;
			this.potato.style.zIndex='2';
			this.potato.style.border="solid 1px #fff";
			this.potato.style.position="absolute";
		 }
		this.food_x=Math.floor(Math.random()*(stepW));
		this.food_y=Math.floor(Math.random()*(stepH));
		this.potato.style.left=this.food_x*this.width+"px";
		this.potato.style.top=this.food_y*this.height+"px";
		document.body.appendChild(this.potato); 
		console.log(this.food_x*20,this.food_y*20)
	}
}
/*画蛇*/
function Snake(){
	//用数组表示蛇
	this.section=[[0,1,'yellowgreen',null],[1,1,'yellowgreen',null],[2,1,'pink',null]];
	this.sectionHeadRun='right';//默认往右边走
	this.range=20;//步长
	this.width=window.innerWidth;//画布宽度
	this.height=window.innerHeight;//画布高度
	this.stepW=this.width/this.range;
	this.stepH=this.height/this.range;
	console.log(this.stepW)
	this.showSection=function(){
		//遍历数组获得蛇
		for(var i in this.section){
			/*判断每个蛇节是否被创建，用数组保存节点*/
			if(this.section[i][3]==undefined){
				//创建每个蛇端的div
				this.section[i][3]=document.createElement("div");
				this.section[i][3].style.background=this.section[i][2];
				this.section[i][3].style.width=this.range-2+'px';
				this.section[i][3].style.height=this.range-2+'px';
				this.section[i][3].style.position='absolute';
				this.section[i][3].style.border='solid 1px #F0F0F0';
			}
			//已经被创建的蛇节只会进来更改位置，不进入上面if（）
			this.section[i][3].style.left=this.section[i][0]*this.range+'px';
			this.section[i][3].style.top=this.section[i][1]*this.range+'px';
			document.body.appendChild(this.section[i][3]);
		}
	}
	/*移动蛇 先移动蛇身*/
	this.moveSection=function(){
		//移动蛇身
		for(var i=0;i<this.section.length-1;i++){
			this.section[i][0]=this.section[i+1][0];//x轴向前一步
			this.section[i][1]=this.section[i+1][1];//y轴向前一步
		}
		//移动头部
		if(this.sectionHeadRun=='right'){
			this.section[this.section.length-1][0] += 1;
		}
		if(this.sectionHeadRun=='left'){
			this.section[this.section.length-1][0] -= 1;
		}
		if(this.sectionHeadRun=='up'){
			this.section[this.section.length-1][1] -= 1;
		}
		if (this.sectionHeadRun=='down'){
			this.section[this.section.length-1][1] += 1;
		}
		/*判断蛇的头部坐标是否超过600px，数组不能超过30；*/
		if(this.section[this.section.length-1][0]>=this.stepW||this.section[this.section.length-1][0]<0||this.section[this.section.length-1][1]>=this.stepH||this.section[this.section.length-1][1]<0){
			clearInterval(time);//停止计时器
			console.log("不能越界，游戏结束");
			$('kaishi').style.display='block'
			location.reload();//我只好强制刷新了
			return false;//停止函数执行
		}
		/*判断蛇是否吃到自己:判断头部坐标和蛇节是否有相等*/
		var touX=this.section[this.section.length-1][0];
		var touY=this.section[this.section.length-1][1];
		//遍历蛇节
		 for(var i=0;i<this.section.length-1;i++){
		 	if(this.section[i][0]==touX&&this.section[i][1]==touY){
		 		clearInterval(time);//停止计时器
		 		console.log("不能吃自己，游戏结束");
		 		$('kaishi').style.display='block'
		 		location.reload();//我只好强制刷新了
				return false;//停止函数执行
		 	}
		 }
		/*判断蛇头是否接触食物*/
		var headX=this.section[this.section.length-1][0];
		var headY=this.section[this.section.length-1][1];
		var fx=food.food_x;
		var fy=food.food_y;
		if(headX==fx&&headY==fy){
			//吃，把新蛇节创建出来，新蛇节的坐标就是蛇最后一节的坐标
			var newsection=[this.section[0][0],this.section[0][1],'yellowgreen',null];
			this.section.unshift(newsection);//把蛇节用数组方法添加
			food.foodShow();//重新绘制食物
			score++;
			$('f').innerHTML=score;
		}
		//蛇节的位置发生变化，重新绘制
		this.showSection();
	}
}

/*开始控制按钮 为手机设置的*/
$('kaishi').onclick=function(){
	boo=true;
	score=0;
	$('kaishi').style.display='none'
	time=setInterval('snake.moveSection()',300);//定时调用蛇移动
	

}








/*获取Id函数*/
function $(x){
	return document.getElementById(x);
}
</script>
</body>
</html>