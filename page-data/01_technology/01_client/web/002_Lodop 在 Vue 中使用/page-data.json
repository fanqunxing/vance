{"componentChunkName":"component---src-templates-blog-post-js","path":"/01_technology/01_client/web/002_Lodop 在 Vue 中使用/","result":{"data":{"site":{"siteMetadata":{"title":"Vance’s Blog"}},"markdownRemark":{"id":"62ccf12c-79ac-5c9b-a26f-ffad36f338ec","excerpt":"1、 web 中如何调用打印设备 最简单的是我们使用  函数就可以调用浏览器的打印。不过这样子做对用户的打扰性比较强，不适用于静默打印。 也可以使用 HiPrint，我看了下，觉得不适合小票打印，具体的可以看他的官网http://hiprint.io/ Lodop 我调查后觉得是个不错的选择，文档地址：http…","html":"<h1>1、 web 中如何调用打印设备</h1>\n<ol>\n<li>\n<p>最简单的是我们使用 <code class=\"language-text\">print</code> 函数就可以调用浏览器的打印。不过这样子做对用户的打扰性比较强，不适用于静默打印。</p>\n</li>\n<li>\n<p>也可以使用 HiPrint，我看了下，觉得不适合小票打印，具体的可以看他的官网<a href=\"http://hiprint.io/\">http://hiprint.io/</a></p>\n</li>\n<li>\n<p>Lodop 我调查后觉得是个不错的选择，文档地址：<a href=\"http://www.lodop.net/\">http://www.lodop.net/</a></p>\n</li>\n</ol>\n<h1>2、Lodop 在 Vue 中的简单使用</h1>\n<p>1、封装一个用于加载<code class=\"language-text\">CLodopfuncs.js</code>的模块</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * @param jsSrc  远程打印CLodop.js地址\n * @param programSrc  驱动地址\n * @method getLodop  获取LODOP对象\n * **/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">LodopFuncs</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">programSrc<span class=\"token punctuation\">,</span> jsSrc</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jsSrc <span class=\"token operator\">=</span> jsSrc\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>programSrc <span class=\"token operator\">=</span> programSrc\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">=</span> <span class=\"token keyword\">undefined</span> <span class=\"token comment\">//加载装填</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">loadCLodop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//加载C-Lodop</span>\n<span class=\"token class-name\">LodopFuncs</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">loadCLodop</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">==</span> <span class=\"token string\">\"loading\"</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">==</span> <span class=\"token string\">\"complete\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">=</span> <span class=\"token string\">\"loading\"</span>\n  <span class=\"token keyword\">var</span> head <span class=\"token operator\">=</span>\n    document<span class=\"token punctuation\">.</span>head <span class=\"token operator\">||</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"head\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span>\n    document<span class=\"token punctuation\">.</span>documentElement\n  <span class=\"token keyword\">var</span> <span class=\"token constant\">JS1</span> <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> <span class=\"token constant\">JS2</span> <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> <span class=\"token constant\">JS3</span> <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">//优先调用本地(Localhost)8000端口服务：</span>\n  <span class=\"token constant\">JS1</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost:8000/CLodopfuncs.js?priority=2\"</span>\n\n  <span class=\"token comment\">//如果失败，则调用本地18000端口：</span>\n  <span class=\"token constant\">JS2</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost:18000/CLodopfuncs.js?priority=1\"</span>\n\n  <span class=\"token comment\">//远程打印的核心cldopjs：</span>\n  <span class=\"token constant\">JS3</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jsSrc\n\n  <span class=\"token constant\">JS1</span><span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span>\n    <span class=\"token constant\">JS2</span><span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span>\n    <span class=\"token constant\">JS3</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span>\n      <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">=</span> <span class=\"token string\">\"complete\"</span>\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token constant\">JS1</span><span class=\"token punctuation\">.</span>onerror <span class=\"token operator\">=</span>\n    <span class=\"token constant\">JS2</span><span class=\"token punctuation\">.</span>onerror <span class=\"token operator\">=</span>\n    <span class=\"token constant\">JS3</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span>\n      <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">evt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">=</span> <span class=\"token string\">\"complete\"</span>\n      <span class=\"token punctuation\">}</span>\n  head<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JS1</span><span class=\"token punctuation\">,</span> head<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">)</span>\n  head<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JS2</span><span class=\"token punctuation\">,</span> head<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">)</span>\n  head<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JS3</span><span class=\"token punctuation\">,</span> head<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//获取LODOP对象</span>\n<span class=\"token class-name\">LodopFuncs</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getLodop</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">oOBJECT<span class=\"token punctuation\">,</span> oEMBED</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> <span class=\"token constant\">LODOP</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">LODOP</span> <span class=\"token operator\">=</span> <span class=\"token function\">getCLodop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//获得主对象（getCLodop是在CLodopfuncs.js定义的）</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token constant\">LODOP</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">!==</span> <span class=\"token string\">\"complete\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>CLodopJsState <span class=\"token operator\">==</span> <span class=\"token string\">\"loading\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"网页还没下载完毕，请稍等一下再操作\"</span><span class=\"token punctuation\">)</span>\n\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"您还未安装打印控件，点击确定下载打印控件，安装成功后刷新页面即可进行打印\"</span>\n      <span class=\"token punctuation\">)</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>programSrc<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//清理旧例子的object或embed元素(避免乱提示干扰理解)：</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oEMBED <span class=\"token operator\">&amp;&amp;</span> oEMBED<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">)</span> oEMBED<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>oEMBED<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oOBJECT <span class=\"token operator\">&amp;&amp;</span> oOBJECT<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">)</span> oOBJECT<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>oOBJECT<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">LODOP</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getLodop出错:\"</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> LodopFuncs</code></pre></div>\n<p>2、在 main.js 中引用</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// main.js</span>\n<span class=\"token keyword\">import</span> LodopFuncs <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/utils/LodopFuncs\"</span>\n<span class=\"token keyword\">let</span> Lodop <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LodopFuncs</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../static/CLodop_Setup_for_Win32NT.exe\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//第二个参数是远程打印的clodop.js, 可省略,</span>\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>$lodop <span class=\"token operator\">=</span> Lodop<span class=\"token punctuation\">.</span><span class=\"token function\">getLodop</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>Lodop<span class=\"token punctuation\">)</span> <span class=\"token comment\">//注意需要绑定实例化对象</span></code></pre></div>\n<p>3、在方法中调用打印</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//获取当前页面所有css字符串</span>\n<span class=\"token keyword\">var</span> styleStr <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"style,link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    a <span class=\"token operator\">+=</span> i<span class=\"token punctuation\">.</span>outerHTML\n    <span class=\"token keyword\">return</span> a\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//获取打印区域的html</span>\n<span class=\"token keyword\">var</span> htmlStr <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"printctx2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>outerHTML\n\n<span class=\"token keyword\">var</span> strHTML <span class=\"token operator\">=</span> styleStr <span class=\"token operator\">+</span> htmlStr\n\n<span class=\"token keyword\">var</span> <span class=\"token constant\">LODOP</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$lodop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token constant\">LODOP</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PRINT_INIT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单XX\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//打印初始化</span>\n\n<span class=\"token comment\">// LODOP.SET_PRINTER_INDEX(0); // 选择打印机, 老版本的CLodop驱动中必须加入, 新版可省略</span>\n\n<span class=\"token comment\">// LODOP.SET_PRINT_PAGESIZE(0, \"25cm\", \"14cm\", \"\"); //设定纸张大小</span>\n<span class=\"token constant\">LODOP</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SET_PRINT_MODE</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PRINT_PAGE_PERCENT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//设置缩放</span>\n\n<span class=\"token constant\">LODOP</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ADD_PRINT_HTM</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"20px\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"25%\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"50%\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">,</span> strHTML<span class=\"token punctuation\">)</span>\n\n<span class=\"token constant\">LODOP</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PREVIEW</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//预览</span></code></pre></div>","frontmatter":{"title":"Lodop 在 Vue 中使用","date":"July 24, 2022","description":"如何在页面中调用打印"}},"previous":{"fields":{"slug":"/01_technology/01_client/web/001_如何部署 github pages/"},"frontmatter":{"title":"如何部署 github pages"}},"next":{"fields":{"slug":"/02_miscellaneous_knowledge/04_essay/think/comfortable-programming/"},"frontmatter":{"title":"编程一定要舒适的环境"}}},"pageContext":{"id":"62ccf12c-79ac-5c9b-a26f-ffad36f338ec","previousPostId":"d85d21b1-7ee3-58c8-b046-02bed4b055fc","nextPostId":"ec057887-c922-538e-b7e8-b1845578435c"}},"staticQueryHashes":["2841359383","3257411868"]}