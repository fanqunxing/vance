{"componentChunkName":"component---src-templates-blog-post-js","path":"/01_technology/01_client/web/003_自己实现的网络拓扑图/","result":{"data":{"site":{"siteMetadata":{"title":"Vance’s Blog"}},"markdownRemark":{"id":"05f53c9e-4941-5092-be9f-3853af1efeef","excerpt":"拓扑图库 一 、前言 目前 drawtool.js 已经服务于四个以上的项目。 二 、drawtool.js 提供的功能 drawtool.js…","html":"<h2>拓扑图库</h2>\n<h3>一 、前言</h3>\n<p><em>目前 drawtool.js 已经服务于四个以上的项目。</em></p>\n<h3>二 、drawtool.js 提供的功能</h3>\n<p><strong>drawtool.js</strong> 为图（包含树）这样结构的数据的界面化，提供了解决方案。</p>\n<p>即： 为点和线的图形操作提供了方案。</p>\n<p>可以举例以下几种情况</p>\n<ol>\n<li>画一个流程图。</li>\n<li>画一个组织架构图。</li>\n<li>画一个城市交通图。</li>\n</ol>\n<p>可以看下面的 demo\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 365px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/vance/static/b06feadca2de68e2e9fbe0eeda5b1fea/60097/drawtool.1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3oFB/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQESH/2gAIAQEAAT8hboWZDiz/2gAMAwEAAgADAAAAEEMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAIRAxQf/aAAgBAQABPxBBpyzY9eGJ3yWQLsYf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"这里写图片描述\"\n        title=\"这里写图片描述\"\n        src=\"/vance/static/b06feadca2de68e2e9fbe0eeda5b1fea/60097/drawtool.1.jpg\"\n        srcset=\"/vance/static/b06feadca2de68e2e9fbe0eeda5b1fea/ff44c/drawtool.1.jpg 158w,\n/vance/static/b06feadca2de68e2e9fbe0eeda5b1fea/a6688/drawtool.1.jpg 315w,\n/vance/static/b06feadca2de68e2e9fbe0eeda5b1fea/60097/drawtool.1.jpg 365w\"\n        sizes=\"(max-width: 365px) 100vw, 365px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/vance/static/08ee75bd93d64d3c87ce6a1e6c4ca785/f0afc/drawtool.2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3aEB/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxABAQEBAAAAAAAAAAAAAAAAACEBcf/aAAgBAQABPyGqzr//2gAMAwEAAgADAAAAEIPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAMUFRgf/aAAgBAQABPxC1BQbLkBBMVkz/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"在这里插入图片描述\"\n        src=\"/vance/static/08ee75bd93d64d3c87ce6a1e6c4ca785/828fb/drawtool.2.jpg\"\n        srcset=\"/vance/static/08ee75bd93d64d3c87ce6a1e6c4ca785/ff44c/drawtool.2.jpg 158w,\n/vance/static/08ee75bd93d64d3c87ce6a1e6c4ca785/a6688/drawtool.2.jpg 315w,\n/vance/static/08ee75bd93d64d3c87ce6a1e6c4ca785/828fb/drawtool.2.jpg 630w,\n/vance/static/08ee75bd93d64d3c87ce6a1e6c4ca785/f0afc/drawtool.2.jpg 658w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 538px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/vance/static/f47bf9a51a2f97a9de6163db512c7f26/80320/drawtool.3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAQACBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe6aBiP/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAICH/2gAIAQEABj8CIv8A/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERMSFBUYGh/9oACAEBAAE/IW8wuylMJfpdGzgR/9oADAMBAAIAAwAAABDAz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQVFh8f/aAAgBAQABPxBKULeL4PYpqls3F+QQWhLrJWnOPIABoz5MHHfU/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"在这里插入图片描述\"\n        src=\"/vance/static/f47bf9a51a2f97a9de6163db512c7f26/80320/drawtool.3.jpg\"\n        srcset=\"/vance/static/f47bf9a51a2f97a9de6163db512c7f26/ff44c/drawtool.3.jpg 158w,\n/vance/static/f47bf9a51a2f97a9de6163db512c7f26/a6688/drawtool.3.jpg 315w,\n/vance/static/f47bf9a51a2f97a9de6163db512c7f26/80320/drawtool.3.jpg 538w\"\n        sizes=\"(max-width: 538px) 100vw, 538px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>三、 drawtool.js 提供的 API</h3>\n<h4>1.引入</h4>\n<p>drawtool.js 支持 nodeJs 引入，AMD 规范引入、CMD 规范引入和直接引入。</p>\n<p>标签直接引入：\ndrawtool.css 是内置样式表，可以方便覆盖。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>../drawtool/drawtool.css<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>../drawtool/drawtool.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>drawtool 也支持 npm 安装</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> drawtool</code></pre></div>\n<p>安装后引入如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Drawtool <span class=\"token keyword\">from</span> <span class=\"token string\">\"drawtool\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"drawtool/drawtool.css\"</span></code></pre></div>\n<h4>2.初始化</h4>\n<p>页面放置一个 div，drawtool.js 会根据 div 的大小初始化一个画布。</p>\n<p>html</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>canvas<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>style</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">#canvas</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 800px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 400px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> #fafafa<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>javascript</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> drawtool <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Drawtool</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>3 全局属性配置</h4>\n<p>drawtool.js 在初始化的过程中可以配置一些常用属性。</p>\n<p>可配置属性包括下面：</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>属性</th>\n<th>含义</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>lineColor</td>\n<td>线的颜色</td>\n<td>#26b7d0</td>\n</tr>\n<tr>\n<td>2</td>\n<td>lineHoverColor</td>\n<td>线处于 hover 状态的颜色</td>\n<td>rgba(200, 200, 200, 0.4)</td>\n</tr>\n<tr>\n<td>3</td>\n<td>arrowColor</td>\n<td>箭头的颜色</td>\n<td>#444</td>\n</tr>\n<tr>\n<td>4</td>\n<td>lineStyle</td>\n<td>线有无箭头 arrow 有箭头 none 无箭头</td>\n<td>arrow</td>\n</tr>\n<tr>\n<td>5</td>\n<td>lineType</td>\n<td>线性 broken 折线 bezier 贝塞尔曲线 straight 直线</td>\n<td>bezier</td>\n</tr>\n<tr>\n<td>6</td>\n<td>auto</td>\n<td>是否自动计算控制点，只对折线有效。 true 自动计算， false 不自动计算</td>\n<td>true</td>\n</tr>\n<tr>\n<td>7</td>\n<td>lineActiveColor</td>\n<td>线处于激活状态颜色</td>\n<td>#2177C7</td>\n</tr>\n</tbody>\n</table>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> setting <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">lineColor</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#26b7d0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">lineHoverColor</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#aaa\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">arrowColor</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#444\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">lineStyle</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arrow\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">lineType</span><span class=\"token operator\">:</span> <span class=\"token string\">\"broken\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">auto</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> drawtool <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Drawtool</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">,</span> setting<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>注意：此处配置为全局性的，权重级别最低。</strong></p>\n<h4>4.增加节点</h4>\n<p>drawtool.js 的节点是用 dom 构造，这样做是为了更灵活的操作节点。\n配置一个节点有四个属性：</p>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pos</td>\n<td>节点添加的位置坐标 x 为横坐标， y 为纵坐标</td>\n</tr>\n<tr>\n<td>template</td>\n<td>可以传入 html 字符串模板或者一个 dom 元素，drawtool.js 将会为 html 模板创建一个节点容器，若是 html 字符串，则 innerHTML 方法将模板写入节点容器。若是 dom 元素，则会直接将 dom 元素插入节点容器。</td>\n</tr>\n<tr>\n<td>anchors</td>\n<td>连线点的相对坐标，以 html 模板的中心为坐标系原点。</td>\n</tr>\n<tr>\n<td>nodeid</td>\n<td>节点 id， 为数值类型，不传入会自动递增构造。</td>\n</tr>\n</tbody>\n</table>\n<p>若是采用 vue 等无 dom 开发，可以在 template 内传入 dom。\naddNode 方法的返回值是节点 dom，dom 上挂载了 nodeid 属性。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> option <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">pos</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;div class='node js-node'>test&lt;/div>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">anchors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">addNode</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>nodeid<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>5.删除节点</h4>\n<p>通过 nodeid 可以删除节点。nodeid 可以通过 dom 获取。\n删除节点的同时，会将与之相连的线条全部删除。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// jquery代码示例</span>\n<span class=\"token keyword\">var</span> nodeid <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".js-node\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>nodeid\ndrawtool<span class=\"token punctuation\">.</span><span class=\"token function\">deleteNodeById</span><span class=\"token punctuation\">(</span>nodeid<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>6.清除画布</h4>\n<p>清除画布是删除 drawtool.js 上面所有的节点和连线。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>7.事件监听</h4>\n<p>drawtool.js 提供了事件监听切面，让我们可以控制连线点击等操作。而对于节点事件的操作，则全部交给 dom 完成。</p>\n<p>drawtool.js 提供的事件如下：</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>方法</th>\n<th>含义</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>clickLine</td>\n<td>点击连线</td>\n<td>参数是当前点击的线条</td>\n</tr>\n<tr>\n<td>2</td>\n<td>deleteLineBefore</td>\n<td>删除连线之前</td>\n<td>参数是当前线条，返回 true 表示可以删除，返回 false 不删除。 缺省为 true。</td>\n</tr>\n<tr>\n<td>3</td>\n<td>deleteLineAfter</td>\n<td>删除连线之后</td>\n<td>参数是当前线条</td>\n</tr>\n<tr>\n<td>4</td>\n<td>linkLineBefore</td>\n<td>连线前</td>\n<td>参数是当前线条，此时为点击第二个连线点，返回 true 表示可以连线，返回 false 不连线。 缺省为 true。</td>\n</tr>\n<tr>\n<td>5</td>\n<td>linkLineAfter</td>\n<td>连线后</td>\n<td>参数是当前线条</td>\n</tr>\n<tr>\n<td>6</td>\n<td>linkLineStart</td>\n<td>开始连线</td>\n<td>参数是当前线条，<strong>此处是设置局部线性配置的地方。</strong></td>\n</tr>\n</tbody>\n</table>\n<p>可以使用如下监听方式：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">clickLine</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">deleteLineBefore</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">deleteLineAfter</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">linkLineBefore</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">linkLineAfter</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>drawtool.js 也支持下列调用</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"linkLineStart\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>注意：\n— drawtool.js 不支持重复绑定，重复绑定会引发覆盖操作。\n— 所有的事件方法，this 都指向 drawtool 实例。</strong></p>\n<h4>8.局部属性设置</h4>\n<p><strong>drawtool.js 局部属性是针对线条设置的，它覆盖全局属性。</strong></p>\n<p>通过对 linkLineStart 的监听，调用线条的方法，可以完成局部属性设置。</p>\n<p>支持三种局部属性：</p>\n<ol>\n<li>setStyle 箭头设置， arrow，none；</li>\n<li>setType 线性设置， broken，bezier，straight</li>\n<li>setAuto 是否自动计算，只支持折线， true，false</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 动态设置线的样式</span>\ndrawtool<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"linkLineStart\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  line<span class=\"token punctuation\">.</span><span class=\"token function\">setStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"arrow\"</span><span class=\"token punctuation\">)</span>\n  line<span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"broken\"</span><span class=\"token punctuation\">)</span>\n  line<span class=\"token punctuation\">.</span><span class=\"token function\">setAuto</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>9.禁用模式</h4>\n<p>drawtool.js 可以设置禁用模式</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">setDisabled</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>setDisabled 方法接收一个布尔值，\ntrue 为禁用模式，false 为非禁用模式。\n<strong>禁用模式下，点线事件失效，但可以通过 api 调用。</strong></p>\n<h4>10.存为图片</h4>\n<p>drawtool.js 利用 svg 和 canvas 合成图片。。\n若有图片，受 svg 限制，<strong>必须使用 img 标签引入图片，使用 background 将不会被支持导出</strong>。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">getImage</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> deep<span class=\"token punctuation\">)</span></code></pre></div>\n<p>fn — 回调方法，函数类型。参数为 base64 编码。\ndeep — 是否深获取，布尔类型，true 为下载图片。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">getImage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>注意：受浏览器兼容影响，ie 浏览器不支持，若完成复杂的图片存储，建议采用其他插件配合完成。</strong></p>\n<h4>11.数据存储</h4>\n<p>drawtool.js 内部管理节点栈和连线栈。我们可以通过接口，来获取数组格式的节点和连线。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> lineArr <span class=\"token operator\">=</span> drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">getAllLines</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> nodeArr <span class=\"token operator\">=</span> drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">getAllNodesInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nlocalStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lineArr\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>lineArr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nlocalStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nodeArr\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>nodeArr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>drawtool.js 还管理了所有的 canvas 上的所有 dom，我们也可以获取。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> domArr <span class=\"token operator\">=</span> drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">getAllNodes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>12.数据读取</h4>\n<p>drawtool.js 可以直接读取节点和连线数组，来初始化画布。</p>\n<p><strong>init 方法可以直接读取 drawtool.js 输出的数据。</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> lineArr <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lineArr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> nodeArr <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nodeArr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ndrawtool<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>nodeArr<span class=\"token punctuation\">,</span> lineArr<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>13.vue 中使用</h4>\n<p>drawtool.js 没有对 dom 进行控制，而是通过 addNode 方法将 dom 的操作权转让给外界。也即 drawtool.js 不干涉 dom 行为，只提供一个节点容器。</p>\n<p>例如下面：\n可以构造一个 node 模板</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">@contextmenu</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>show<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>A<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">v-if</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>option<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>deletes<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>删除<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">option</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>option <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>option\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">deletes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deleteClick\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>然后在主模块中做如下操作：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> option <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">pos</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">anchors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawtool<span class=\"token punctuation\">.</span><span class=\"token function\">addNode</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>四、 性能</h3>\n<p>drawtool.js 最大性能问题是事件和渲染，\n事件：drawtool.js 内部实现了自己的事件方法，优化管理事件。\n渲染：drawtool.js 采用局部渲染方法，保证最小程度的重绘。</p>\n<h3>五、 自我保护</h3>\n<h4>1. 数据私有化</h4>\n<p>drawtool.js 所有数据都采用 getter/setter 获取和设置。</p>\n<h4>2. 动态 class</h4>\n<p>drawtool.js 提供了 dom 的标准化获取方法，不建议使用 dom 操作来获取和操作 dom，因此 drawtool.js 会将关键的 dom 采用动态 class 生成方法，来防止外界直接操作 dom。</p>\n<h3>六、 存在的问题</h3>\n<ul>\n<li>线上文字未实现。</li>\n</ul>\n<h3>七、 代码 demo</h3>\n<p>版本： 1.1.1\n代码量：28k</p>\n<p>版本： 1.2.0\n代码量：53k</p>\n<p>gitHub 地址：\n<a href=\"https://github.com/fwx426328/drawtool\">https://github.com/fwx426328/drawtool</a></p>","frontmatter":{"title":"自己实现的网络拓扑图","date":"September 09, 2018","description":"自己实现的网络拓扑图"}},"previous":{"fields":{"slug":"/02_miscellaneous_knowledge/04_essay/think/holmes/"},"frontmatter":{"title":"福尔摩斯与代码"}},"next":{"fields":{"slug":"/01_technology/03_tools/git/"},"frontmatter":{"title":"git 常用操作"}}},"pageContext":{"id":"05f53c9e-4941-5092-be9f-3853af1efeef","previousPostId":"0662cec1-8460-5b67-95f5-efe6e4abbab3","nextPostId":"3c6089f9-99e7-5480-84a2-ac82700d5edb"}},"staticQueryHashes":["2841359383","3257411868"]}